"use strict";function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var _typeof_1=createCommonjsModule(function(e){function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return"function"==typeof Symbol&&"symbol"===o(Symbol.iterator)?e.exports=r=function(t){return o(t)}:e.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":o(t)},r(t)}e.exports=r}),WpPwapi2=function(u){function i(t){var e,o,r,a=document.createElement("a"),i={};for(a.href=t,e=a.search.replace(/^\?/,"").split("&"),r=0;r<e.length;r++)i[(o=e[r].split("="))[0]]=o[1];return{protocol:a.protocol,host:a.host,hostname:a.hostname,port:a.port,pathname:a.pathname,search:a.search,searchObject:i,hash:a.hash}}function h(t){try{if(!t)return!1;if("string"==typeof t||t instanceof String){for(var e=i(t),o=0;o<y.validOriginBaseDomains.length;o++)if(r=e.hostname,a=y.validOriginBaseDomains[o],r&&a&&null!=r.match(a+"$"))return!0}else S.error(w+": isOriginValid: origin is not a string: "+JSON.stringify(t))}catch(t){S.error(w+": isOriginValid unable to process: "+t.message,t)}var r,a;return!1}function n(t,e,o){if(!(this instanceof n))return new n(t,e);if(!t){var r=w+": initLocStorApi: iframeId is blank/null";throw S.error(r),new Error(r)}if(!e){r=w+": initLocStorApi: callback is blank/null";throw S.error(r),new Error(r)}var a=document.getElementById(t);if(!a){r=w+": initLocStorApi: iframe id: "+t+", iframeElement is null";throw S.error(r),new Error(r)}var i=a.contentWindow;if(!i){r=w+": initLocStorApi: iframe id: "+t+", contentWindow is null";throw S.error(r),new Error(r)}if(!o){r=w+": initLocStorApi: targetOrigin is blank";throw S.error(r),new Error(r)}if(!h(o)){r=w+": initLocStorApi: targetOrigin is not valid";throw S.error(r),new Error(r)}this.targetOrigin=o,this.locStorApiIframeWindow=i,this.iframeEventListenerLocStorApiReference=this.locStorApiEventListener.bind({thiss:this,callback:e}),u.addEventListener("message",this.iframeEventListenerLocStorApiReference,!1)}function d(t,e,o,r,a,i,n,s,l){if(!(this instanceof d))return new d(t,e,o,r,a,i,n,s,l);this.$jq=t,this.apiurl=e,this.cookieDomain=o,this.path=r,this.args=a,this.successCallback=i,this.errorCallback=n,this.doPwapi=s,this.doLocalStorage=l,this.timeoutMillis=15e3,o||(this.cookieDomain=y.defaultCookieDomain),a||(this.args={}),r||(this.path="/"),0!=this.path.indexOf("/")&&(this.path="/"+this.path),null==s&&(this.doPwapi=!0),null==l&&(this.doLocalStorage=!0)}var S=console||{log:function(){},error:function(){}},w="wpPwapi2.js",y={version000:"20180525.2",doPwapi:!0,doLocalStorage:!0,defaultCookieDomain:".washingtonpost.com",subscribeSubDomainIframeId:"pwapiCrsDmnLocStor_subscribe_iframe",subscribeSubDomainGetData:!1,cmdRequestGetStor:"cmdGetFromStorage",cmdRequestDeleteStor:"cmdDeleteFromStorage",cmdRequestSetStor:"cmdSetInStorage",cmdRequestGetAllStor:"cmdGetAllFromStorage",validOriginBaseDomains:["\\.washingtonpost\\.com","\\.digitalink\\.com"],validDocumentDomains:["washingtonpost.com","digitalink.com"],abRefPt:"http://pwapiptrf._pwapiptrf_.com",processId:(new Date).getTime()},t=36e5,f=[{name:"wapo_actmgmt",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wapo_login_id",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wapo_secure_login_id",expireOffsetMillis:t,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0}];d.prototype.setCallbacks=function(t,e){this.successCallback=t,this.errorCallback=e},d.prototype.storageAvailable=function(t){if(!t)return!1;try{var e=u[t],o="_wpPwapi1_js_stor_avail_";return e.setItem(o,o),e.removeItem(o),!0}catch(t){return!1}},d.prototype.allStorageAvailable=function(){var t=this.storageAvailable("localStorage"),e=this.storageAvailable("sessionStorage");return t&&e},d.prototype.getStorageData=function(t,o){if(null!=t&&null!=o&&this.allStorageAvailable()){for(var r=[],a=0;a<f.length;a++){var i=f[a],n=i.name;if(i.toPwapi&&n){var s=o.getItem(n);if(s){try{s=s.trim()}catch(t){S.error(w+" : getStorageData: unable to trim storageItemStr: "+s+", for key: "+n+" ::: "+t.message,t);continue}var l=null;try{if("{"!==s[0])continue;var c=(l=JSON.parse(s)).e;if(o===localStorage&&c<(new Date).getTime()){r.push(n);continue}this.args[n]=l.v}catch(t){S.error(w+" : getStorageData: unable to json parse: "+s+", for key: "+n+" ::: "+e.message,t);continue}}}}for(a=0;a<r.length;a++)o.removeItem(r[a])}},d.prototype.getAllStorageData=function(){if(this.doLocalStorage&&y.doLocalStorage){if(!this.allStorageAvailable())return{};var t={};return this.getStorageData(t,localStorage),this.getStorageData(t,sessionStorage),t}S.log(w+" : getAllStorageData : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+y.doLocalStorage)},d.prototype.getFromLocalOrSessionStorage=function(t){if(!this.allStorageAvailable()||!t)return null;var e=localStorage.getItem(t);return null==e&&(e=sessionStorage.getItem(t)),e},d.prototype.storeDataLocalStorage=function(t,e,o){var r={};r.v=e,r.e=o;var a=JSON.stringify(r);0===o?sessionStorage.setItem(t,a):o<0||o<(new Date).getTime()?(sessionStorage.removeItem(t),localStorage.removeItem(t)):localStorage.setItem(t,a)},d.prototype.storDelete=function(t){this.doLocalStorage&&y.doLocalStorage?this.allStorageAvailable()&&t&&this.storeDataLocalStorage(t,"",-1):S.log(w+" : storDelete : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+y.doLocalStorage)},d.prototype.storeData=function(t){if(this.doLocalStorage&&y.doLocalStorage){if(this.allStorageAvailable()){if(!t)throw"storeData: response data is null/blank";var e=t.pwresp.locstor;if(e&&!(e.length<1))for(var o=0;o<e.length;o++){var r=e[o],a=r.k,i=r.v,n=r.e;null!=a&&null!=i&&null!=n&&("string"==typeof a&&"number"==typeof n?this.storeDataLocalStorage(a,i,n):S.error(w+" : k is not string, or ex is not number for: "+JSON.stringify(r)))}}}else S.log(w+" : storeData : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+y.doLocalStorage)},d.prototype.storeDataCookies=function(t,e,o,r){if(t){var a="",i="";if(o<0?a=";expires="+new Date(1e3).toUTCString:0<o&&(a=";expires="+new Date(o).toUTCString()),null!=this.cookieDomain&&(i=";domain="+this.cookieDomain),e=e||"",r)var n=e;else n=encodeURIComponent(e);var s=t+"="+n+";path=/"+a+i;document.cookie=s}},d.prototype.setCookieDomain=function(t){this.cookieDomain=t||y.defaultCookieDomain},d.prototype.deleteCookie=function(t){null!=t&&""!==(t=t.trim())&&this.storeDataCookies(t,"",1e3)},d.prototype.getCookie=function(t,e){if(!t)return null;if(!e&&void 0!==this.cookieCache)return this.cookieCache[t];if(!document.cookie)return null;for(var o={},r=null,a=document.cookie.split(";"),i=0;i<a.length;i++)if(0<a[i].indexOf("=")){var n=a[i].split("="),s=n[0],l=n[1];(s=s&&s.trim())===t&&(r=(l=l||"").trim()),o[s]=l.trim()}return this.cookieCache=o,r},d.prototype.deleteAllStorageAndCookies=function(){for(var t=0;t<f.length;t++){var e=f[t].name;this.deleteCookie(e),this.storDelete(e)}},d.prototype.synchCookiesAndLocalStorage=function(){if(this.doLocalStorage&&y.doLocalStorage){if(this.allStorageAvailable()){for(var t={},e={},o=0;o<f.length;o++){var r=f[o];try{var a=r.name,i=r.expireOffsetMillis,n=this.getCookie(a),s=localStorage.getItem(a),l=null;s&&(l=JSON.parse(s)).e<(new Date).getTime()&&(l=null,localStorage.removeItem(a));var c=null!=n,p=null!=l;if(c&&p)continue;if(c&&r.cookiesToLocalStorage){var g=(new Date).getTime()+i;this.storeDataLocalStorage(a,n,g),t[a]=n}else p&&r.localStorageToCookies&&(this.storeDataCookies(a,l.v,l.e,r.notEncoded),e[a]=l.v)}catch(t){S.error(w+" : Unable to synchCookiesAndLocalStorage for synchCookie item: "+JSON.stringify(r),t)}}try{0<Object.keys(e).length||Object.keys(t).length}catch(t){}}}else S.log(w+" : synchCookiesAndLocalStorage : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+y.doLocalStorage)},d.prototype.procfn=function(t,e,o,r,a){if(t)try{r||a?t(r,a,y.processId):t(o)}catch(t){S.error(w+" : "+e,t)}},d.prototype.setTimeout=function(t){t&&!isNaN(t)&&(this.timeoutMillis=t)},d.prototype.subDomainSubscribeLocStorCallback=function(t,e){e&&e.tag?this.locstorSubscribe?"myGetTag"===e.tag&&(S.log(w+": debug subDomainSubscribeLocStorCallback: callback myGetTag: "+JSON.stringify(e)),this.locstorSubscribe.close(),this.procInternal()):S.error(w+": subDomainSubscribeLocStorCallback: self.locstorSubscribe is null"):S.error(w+": subDomainSubscribeLocStorCallback: data or data.tag is null")},d.prototype.proc=function(){this.procInternal()},d.prototype.getContentSection=function(){try{var t=u.wp_section;return(t=t||u.TWP&&u.TWP.Data&&u.TWP.Data.Tracking&&u.TWP.Data.Tracking.props&&u.TWP.Data.Tracking.props.section)?""==(t=t.trim())?null:t:null}catch(t){return null}},d.prototype.getSubscriberOnlyTags=function(){try{var t=u.wp_meta_data.tags_for_paywall_subs;return t?""==(t=t.trim())?null:t:null}catch(t){return null}},d.prototype.getContentTags=function(){try{var t=u.wp_meta_data.tags_for_paywall;return t?""==(t=t.trim())?null:t:null}catch(t){return null}},d.prototype.procInternal=function(){var o=this;if(this.doPwapi&&y.doPwapi){if(!o.apiurl){var t=w+": apiurl is null";throw S.error(t),new Error(t)}if(!h(o.apiurl)){t=w+": apiurl invalid";throw S.error(t),new Error(t)}o.args.referrer||(o.args.referrer=""),o.args.referrer=o.args.referrer.trim(),o.originalReferrer=o.args.referrer;var e=o.getContentSection();e&&(o.args.pwapi_contentsection=e);var r=o.getContentTags();r&&(o.args.pwapi_ct_tags=r);var a=o.getSubscriberOnlyTags();a&&(o.args.pwapi_sct_tags=a),o.getAllStorageData();try{o.synchCookiesAndLocalStorage()}catch(t){S.error(w+" :: unable to synchCookiesAndLocalStorage: "+t.message,t)}var i="pwapi"+Math.random().toString().substr(2);u[i]=function(e){u.pwapiResponse=(new Date).getTime()-p;try{o.storeData(e),u.pwapiPaywallResponse=e}catch(t){S.error(w+" : Unable to local storage: "+t.message,e)}var t=e;o.procfn(o.successCallback,"successCallback",t,null,null)};var n,s=(-1===this.path.indexOf("?")?"?":"&")+"callback="+i,l="&";for(n in this.args)l+=n+"="+encodeURIComponent(this.args[n])+"&";var c=u.performance&&u.performance.timing||{},p=(new Date).getTime();u.pwapiStart=p-(c.navigationStart||0);try{u.pwapiPaywallStatus=0,u.pwapiPaywall=0;var g=new XMLHttpRequest;g.open("GET",o.apiurl+this.path+s+l,!0),g.timeout=15e3,g.withCredentials=!0,g.send(),g.onload=function(){var t=new RegExp(i+"\\((.*)\\)","i"),e=g.responseText.match(t)[1],o=JSON.parse(e);u.pwapiPaywallStatus=200,function(){var t=localStorage.getItem("wp_sponsored");if(-1<u.location.search.indexOf("das=pw_spsrd_hit")||-1<u.location.search.indexOf("pw_unlock_mgclink")){if(localStorage.setItem("wp_sponsored",u.location.pathname),"function"==typeof history.replaceState){var e=u.location.href;e=e.replace(/das\=[^\&]*/,""),history.replaceState({},null,e)}return!0}return!(!t||u.location.pathname!=t)}()&&(o.pwresp.action=0,o.pwresp.data={}),function(t){if("object"==_typeof_1(t.pwresp.data.actions)&&0<t.pwresp.data.actions.length){if(-1!=t.pwresp.data.actions.indexOf(12))return u.pwapiPaywall=12,!0;if(-1!=t.pwresp.data.actions.indexOf(120))return u.pwapiPaywall=120,!0}return!1}(o)&&(o.pwresp.action=3),function(){try{var t=u.TWP&&u.TWP.Data&&u.TWP.Data.Tracking&&u.TWP.Data.Tracking.props;if(t&&-1!=["podcasts","video","gallery"].indexOf(t.content_type))return!0;if(t&&-1!=t.commercial_node.indexOf("bytheway"))return!0}catch(t){console.log("Special Content Error",t)}return!1}()&&(o.pwresp.action=0),o.pwresp.processId=y.processId,u.pwapiPaywall=o.pwresp.action,u[i](o)},g.onerror=function(){u.pwapiPaywallStatus=500,console.error("PWAPI ERROR"),o.procfn(o.errorCallback,"errorCallback",null,null,"Pwapi error")},g.ontimeout=function(){(new Date).getTime();u.pwapiPaywallStatus=504,console.error("PWAPI TIMEOUT"),o.procfn(o.errorCallback,"errorCallback",null,null,"Pwapi timeout")}}catch(t){u.pwapiPaywallStatus=500,console.error("PWAPI ERROR"),o.procfn(o.errorCallback,"errorCallback",null,null,"Pwapi error "+t)}}else S.log(w+" : Warning: not calling pwapi: this.doPwapi: "+this.doPwapi+", config.pwapi: "+y.doPwapi)},n.prototype.proc=function(t){if(!t)return S.error(w+": locStorApiCall: cmdObj is blank/null"),!1;if(!this.locStorApiIframeWindow){var e=w+": locStorApiCall: locStorApiIframeWindow is blank/null";throw S.error(e),new Error(e)}this.locStorApiIframeWindow.postMessage(JSON.stringify(t),this.targetOrigin)},n.prototype.locStorApiEventListener=function(e){if(e&&e.origin){if(!h(e.origin))return S.error(w+": locStorApiEventListener: event origin is not valid"),void S.error(e.origin);try{this.callback(this.thiss,JSON.parse(e.data))}catch(t){S.error(w+": locStorApiEventListener: uable to call callback function with data: "+e.data+" :: err.message: "+t.message,t)}}else S.error(w+": locStorApiEventListener: ev or ev.origin is blank")},n.prototype.cmdGet=function(){return y.cmdRequestGetStor},n.prototype.cmdGetAll=function(){return y.cmdRequestGetAllStor},n.prototype.cmdDelete=function(){return y.cmdRequestDeleteStor},n.prototype.cmdSet=function(){return y.cmdRequestSetStor},n.prototype.close=function(){this.iframeEventListenerLocStorApiReference&&u.removeEventListener("message",this.iframeEventListenerLocStorApiReference,!1)};var o=u.location.href,r=i(u.location.href),b=null;try{var a=!1;if(r&&r.searchObject){var s=r.searchObject,l=s.pwapisetddmn;if(l&&"1"===l){var c=s.pwapiddmn;c&&function(e){if(!e)return!1;try{for(var t=0;t<y.validDocumentDomains.length;t++)if(e===y.validDocumentDomains[t])return!0}catch(t){S.error(w+": isDocumentDomainValid: Unable to determine for dd: "+e,t)}return!1}(c)&&(document.domain=c,a=!0),a=a&&!(!(b=s.targetorigin)||!h(b))}}var v=null;if(a){try{v=u.parent}catch(t){}u.addEventListener("message",function(e){try{if(!e)return;if(!h(e.origin))return;var t=e.data;if(!t)return;var o=new d;if(!o.allStorageAvailable())return void S.log(w+": Warn local/session storage not available");var r=JSON.parse(t),a=r.cmd;if(!a)return;var i={cmd:a};if(r.tag&&(i.tag=r.tag),a===y.cmdRequestGetStor){if(i.stor={},l=r.keys)for(var n=0;n<l.length;n++){var s=o.getFromLocalOrSessionStorage(l[n]);i.stor[l[n]]=s}}else if(a===y.cmdRequestDeleteStor){var l;if(l=r.keys)for(n=0;n<l.length;n++)o.storDelete(l[n]);i=r}else if(a===y.cmdRequestSetStor){var c=r.stor,p=(r.type,localStorage);if(c)for(var g in c)c.hasOwnProperty(g)&&p.setItem(g,c[g]);i=r}else if(a===y.cmdRequestGetAllStor){i.local={},i.session={};var u=localStorage.length,f=sessionStorage.length;for(n=0;n<u;n++){var m=localStorage.key(n);s=localStorage.getItem(m);i.local[m]=s}for(n=0;n<f;n++){m=sessionStorage.key(n),s=sessionStorage.getItem(m);i.session[m]=s}}v&&b?v.postMessage(JSON.stringify(i),b):S.error(w+": parentWindow is null or targetOrigin is blank")}catch(t){S.error(w+": iframe message event listener unable to respond: e.origin: "+e.origin+", e.data: "+e.data+" :: err.message: "+t.message,t)}},!1)}}catch(t){S.error(w+": Unable to set document domain based on url: "+o+", err :: "+t.message,t)}return{pwapi:d,locstor:n}}(window),wpPwapi=function(t){var r=null,e=t.document.location.hostname||"subscribe.digitalink.com",o=".washingtonpost.com",a="https://pwapi.washingtonpost.com";-1!==e.indexOf(".digitalink.com")?(o=".digitalink.com",a="https://testpwapi.digitalink.com"):-1!==e.indexOf("pb-impact.")&&(a="https://pwapi-stage.washingtonpost.com");var i={referrer:document.referrer},n=t.location.pathname+t.location.search,s=null;var l=new WpPwapi2.pwapi(null,a,o,n,i,function(t){"function"==typeof callbackSuccessFunction?callbackSuccessFunction(t):s=t},function(t,e,o){"function"==typeof r?r(t,e):responseError={errTextStatusStr:t,errThrownStr:e,processId:o}});l.registerSucccessCallback=function(t){callbackSuccessFunction=t,"object"===_typeof_1(s)&&callbackSuccessFunction(s)},l.registerErrorCallback=function(t){r=t,"object"===("undefined"==typeof responseError?"undefined":_typeof_1(responseError))&&r(responseError)};try{l.proc()}catch(t){console.error("Unable to call pwapi: err message: "+t.message,t)}return l}(window),WpPwapi1=function(t,c){return{pwapi:function(t,e,o,r,a,i,n,s,l){return c.registerSucccessCallback(i),c.registerErrorCallback(n),{proc:function(){}}},locstor:t.WpPwapi2.locstor}}(window,wpPwapi);
